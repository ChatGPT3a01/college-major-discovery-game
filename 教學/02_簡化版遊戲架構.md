# RPG 遊戲架構：從零到有的結構指南

> 本文件展示如何從零開始構建一個 RPG 教育遊戲。包含完整架構、核心機制、數據結構設計。

---

## 🎮 遊戲核心架構

```
┌─────────────────────────────────────────────────────────┐
│                    RPG 遊戲系統架構                       │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │   遊戲入口    │  │   角色系統    │  │   屬性系統    │   │
│  │ (Start Game) │  │  (Characters)│  │ (Attributes) │   │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘   │
│         │                  │                  │           │
│         └──────────────────┼──────────────────┘           │
│                            │                             │
│         ┌──────────────────▼────────────────────┐        │
│         │      故事流程引擎 (Story Engine)      │        │
│         │   • 讀取故事劇本                     │        │
│         │   • 管理故事分支                     │        │
│         │   • 計算屬性變化                     │        │
│         └──────────────────┬────────────────────┘        │
│                            │                             │
│  ┌──────────────┐  ┌──────▼───────┐  ┌──────────────┐   │
│  │   AI 生成器   │  │  視覺化系統   │  │   結果引擎    │   │
│  │ (AI Engine)  │  │  (UI/Chart)  │  │ (Result Eng) │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

---

## 📊 核心數據結構

### 1. 導師角色結構

```javascript
// 導師數據模型
const Teacher = {
  id: "teacher_001",
  name: "陳美琪",
  field: "環保工程",
  bio: "一位充滿熱情的環保工程師，致力於可持續發展",

  // 角色特徵
  personality: ["熱血", "實踐型", "鼓勵者"],
  tagline: "改變世界，從一個決定開始",

  // 屬性影響範本
  attributeBonus: {
    creativity: 5,    // 創意力
    analysis: 3,      // 分析力
    leadership: 8,    // 領導力
    empathy: 6,       // 同理心
    courage: 7,       // 勇氣
    curiosity: 4      // 好奇心
  },

  // 故事分支
  storyBranches: [
    {
      id: "story_001",
      chapter: "初次相遇",
      scenario: "你和陳美琪在一個環保研討會上相遇...",
      choices: [
        {
          id: "choice_A",
          text: "主動詢問她的工作內容",
          result: "她非常高興地為你介紹環保工程的未來",
          attributeChanges: { leadership: +2, curiosity: +3 }
        },
        // ... 更多選擇
      ]
    }
  ]
};
```

### 2. 玩家屬性系統

```javascript
// 玩家屬性模型
const PlayerAttributes = {
  creativity: 50,      // 創意力 (0-100)
  analysis: 50,        // 分析力 (0-100)
  leadership: 50,      // 領導力 (0-100)
  empathy: 50,         // 同理心 (0-100)
  courage: 50,         // 勇氣 (0-100)
  curiosity: 50        // 好奇心 (0-100)
};

// 屬性計算函數
function updateAttributes(playerAttrs, changes) {
  return {
    creativity: Math.min(100, playerAttrs.creativity + changes.creativity),
    analysis: Math.min(100, playerAttrs.analysis + changes.analysis),
    // ... 其他屬性
  };
}
```

### 3. 故事結構

```javascript
// 故事樹結構
const StoryNode = {
  id: "node_001",
  title: "轉折點",
  chapter: 1,
  teacherId: "teacher_001",

  // 故事文本
  narrative: "此時此刻，你面臨一個重大決定...",

  // 分支選擇
  choices: [
    {
      id: "choice_1",
      text: "冒險嘗試新方案",
      nextNodeId: "node_002",
      attributeDeltas: {
        creativity: 5,
        courage: 8,
        analysis: -2
      }
    },
    {
      id: "choice_2",
      text: "選擇保守策略",
      nextNodeId: "node_003",
      attributeDeltas: {
        analysis: 5,
        courage: -3
      }
    }
  ]
};
```

---

## 🔄 遊戲流程圖

```
開始遊戲
    ↓
[輸入玩家名字]
    ↓
初始化屬性 (都設定為 50)
    ↓
選擇第一位導師
    ↓
┌─────────────────────────────────────┐
│        故事互動循環                   │
│                                     │
│  1. 顯示故事場景 (narrative)        │
│  2. 提供選擇 (3 個選項)             │
│  3. 玩家選擇                        │
│  4. 計算屬性變化                    │
│  5. 顯示結果反饋                    │
│  6. 是否繼續？                      │
│     是 → 下一個故事節點              │
│     否 → 到結果頁面                  │
└─────────────────────────────────────┘
    ↓
[與多位導師互動]
    ↓
[屬性值累積]
    ↓
最終結果頁面
    ├─ 顯示最終屬性雷達圖
    ├─ AI 生成個性化結果
    ├─ 推薦相關科系
    └─ 分享/保存結果
    ↓
遊戲結束
```

---

## 🛠️ 最小可行產品 (MVP) 設計

### Phase 1：核心引擎 (Week 1-2)

```
必需元素：
✓ 基本故事讀取系統
✓ 屬性計算邏輯
✓ 簡單 UI (文字版)
✓ 1 位導師 × 3 個故事節點

代碼行數：~300-500 行 JavaScript
```

**最簡單的實現**：

```javascript
// MVP: 故事引擎的核心邏輯
class StoryEngine {
  constructor() {
    this.currentNode = null;
    this.playerAttributes = {
      creativity: 50, analysis: 50, leadership: 50,
      empathy: 50, courage: 50, curiosity: 50
    };
  }

  // 1. 加載故事
  loadStory(storyId) {
    this.currentNode = stories[storyId];
    this.displayStory();
  }

  // 2. 顯示故事
  displayStory() {
    console.log(this.currentNode.narrative);
    this.currentNode.choices.forEach((choice, idx) => {
      console.log(`${idx + 1}. ${choice.text}`);
    });
  }

  // 3. 處理選擇
  makeChoice(choiceIndex) {
    const choice = this.currentNode.choices[choiceIndex];

    // 更新屬性
    this.playerAttributes = this.updateAttributes(
      this.playerAttributes,
      choice.attributeDeltas
    );

    // 移動到下一個節點
    this.currentNode = stories[choice.nextNodeId];
  }

  // 4. 屬性更新
  updateAttributes(attrs, deltas) {
    return {
      creativity: Math.max(0, Math.min(100, attrs.creativity + deltas.creativity)),
      analysis: Math.max(0, Math.min(100, attrs.analysis + deltas.analysis)),
      // ... 其他屬性
    };
  }
}
```

### Phase 2：視覺化與 AI (Week 3-4)

```
新增元素：
✓ 屬性雷達圖 (Recharts)
✓ AI 結果生成 (Gemini API)
✓ 響應式設計
✓ 5 位導師 × 8-10 個故事節點

代碼擴展：~1000-1500 行
```

### Phase 3：完整功能 (Week 5+)

```
完整元素：
✓ 11 位導師
✓ 50+ 故事節點
✓ 分享功能
✓ 數據存儲
✓ 圖片提示詞生成
✓ 完整音樂/音效系統

總代碼：~2000+ 行
```

---

## 📁 推薦的文件結構

```
my-rpg-game/
├── src/
│   ├── data/
│   │   ├── teachers.js          # 所有導師數據
│   │   ├── stories.js           # 故事樹
│   │   └── attributeMap.js      # 屬性映射
│   ├── components/
│   │   ├── StoryDisplay.jsx     # 故事展示
│   │   ├── ChoiceButtons.jsx    # 選擇按鈕
│   │   ├── AttributeRadar.jsx   # 屬性雷達圖
│   │   └── ResultPage.jsx       # 結果頁面
│   ├── services/
│   │   ├── storyEngine.js       # 故事引擎
│   │   ├── aiService.js         # AI 結果生成
│   │   └── audioService.js      # 音樂控制
│   ├── hooks/
│   │   ├── useGameState.js      # 遊戲狀態管理
│   │   └── useAttributes.js     # 屬性邏輯
│   └── App.jsx
├── public/
│   ├── audio/                   # 音樂檔案
│   ├── images/                  # 角色圖片
│   └── index.html
└── package.json
```

---

## 🎯 關鍵決策點

| 決策 | 選項 A | 選項 B | 建議 |
|------|--------|--------|------|
| **屬性上限** | 動態 (無上限) | 固定 (0-100) | 固定更易控制 |
| **故事分支** | 線性 (2 個分支) | 複雜 (3+ 分支) | 從線性開始 |
| **AI 整合** | 全部生成 | 混合手工+AI | 混合效果最好 |
| **數據存儲** | 本地 localStorage | 雲端 (Firebase) | MVP 用本地 |
| **美術風格** | 手繪 | 3D 渲染 | AI 生成插畫 |

---

## 💻 實現技術棧建議

### 最小配置 (快速開始)

```
前端：HTML + JavaScript + CSS
故事引擎：純 JavaScript
UI 圖表：Chart.js (輕量)
AI：調用 Gemini API
```

### 標準配置 (推薦)

```
前端框架：React 19
語言：TypeScript
樣式：Tailwind CSS
圖表：Recharts
AI：Gemini/OpenAI API
構建工具：Vite
```

### 完整配置 (專業版)

```
前端：React 19 + TypeScript + Tailwind
後端：Node.js / Python FastAPI
數據庫：Supabase / Firebase
AI：Gemini + 自訓練模型
圖像生成：Stable Diffusion API
部署：Vercel + Railway
```

---

## 🎨 屬性系統設計深度

### 屬性與職業的映射

```
創意力 ────────────► 設計師、建築師、藝術家、企劃
分析力 ────────────► 工程師、數據科學家、醫生
領導力 ────────────► 經理、CEO、政治家、軍事
同理心 ────────────► 心理諮商、社工、教師、醫護
勇氣  ────────────► 冒險家、創業家、運動員、軍人
好奇心 ────────────► 研究者、科學家、記者、哲學家

最佳職業組合：
┌──────────────────────────────────────────┐
│ 創意力 + 分析力 = UI/UX 設計師           │
│ 領導力 + 同理心 = 人資主管               │
│ 勇氣 + 好奇心 = 記者/冒險家             │
│ 分析力 + 好奇心 = 研究人員               │
│ 領導力 + 創意力 = 創意總監               │
└──────────────────────────────────────────┘
```

### 屬性平衡機制

```
問題：玩家容易集中在某些屬性，忽視他人

解決方案：

1. 鼓勵多樣化選擇
   - 每個導師強化不同屬性
   - 故事設計避免同一屬性重複加成

2. 屬性抵消
   - 某些選擇故意減少某屬性 (-3)
   - 迫使玩家考慮權衡

3. 最終建議算法
   - 推薦属性最高的 3 個科系
   - 也推薦「平衡型」科系
   - 展示各科系對屬性的需求
```

---

## 📊 故事數據範例

### 一個完整的故事節點

```javascript
{
  id: "env_chapter1_choice1",
  chapter: "環保工程初體驗",
  teacherId: "teacher_001", // 陳美琪

  narrative: `
    陳美琪帶你走進廢棄工業區。
    "看這些汙染，但背後代表機會。"
    她指著一片湖水。"你會怎麼做？"
  `,

  choices: [
    {
      id: "choice_risk",
      text: "提出一個創新但高風險的治汙方案",
      result: "陳美琪眼睛一亮：'年輕人，我喜歡你的膽子！'",
      nextNodeId: "env_chapter2_innovation",
      attributeDeltas: {
        creativity: 8,
        courage: 6,
        analysis: -2
      }
    },
    {
      id: "choice_safe",
      text: "建議採用已驗證的標準方法",
      result: "她點點頭：'穩健的方法也很重要。'",
      nextNodeId: "env_chapter2_standard",
      attributeDeltas: {
        analysis: 7,
        leadership: 2,
        creativity: -1
      }
    },
    {
      id: "choice_learn",
      text: "先詢問她的方案建議",
      result: "'很好！謙虛的態度是成功的基礎。'",
      nextNodeId: "env_chapter2_learning",
      attributeDeltas: {
        curiosity: 6,
        empathy: 4
      }
    }
  ]
}
```

---

## 🚀 快速開始檢查清單

### 開始前準備

- [ ] 確定遊戲主題和科系數量
- [ ] 列出導師角色 (至少 5 位)
- [ ] 收集導師的真實故事/背景
- [ ] 定義屬性系統 (6 項或自訂)
- [ ] 設計故事框架 (每位導師 5-10 個節點)

### 開發準備

- [ ] 設置開發環境 (Node.js + React)
- [ ] 創建基本文件結構
- [ ] 編寫故事引擎核心 (300-500 行)
- [ ] 設計簡單的 UI 原型
- [ ] 測試屬性計算邏輯

### 內容填充

- [ ] 用提示詞範本生成導師設定
- [ ] 生成故事分支
- [ ] 編寫故事文本
- [ ] 建立故事樹 (JSON 格式)
- [ ] 測試整個遊戲流程

---

> **小提示**：建議從 MVP (1 位導師 + 3 個故事節點) 開始，驗證核心機制後，再逐步擴展到完整版本。
